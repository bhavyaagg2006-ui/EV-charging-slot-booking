<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Search Nearby EV Bunk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    :root{--glow:rgba(34,197,94,.45)}
    body{
      font-family:'Poppins',sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, #0b1224 0%, #0b1224 40%, #0e162b 60%, #111827 100%) fixed;
      color:#fff;
    }
    .glass{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
    }
    .card{
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
    }
    .card:hover{
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0,0,0,.45);
      border-color: var(--glow);
    }
    .ring-glow:focus{
      outline: none;
      box-shadow: 0 0 0 4px var(--glow);
    }
  </style>
</head>
<body class="min-h-screen">

  <!-- Header -->
  <header class="px-6 pt-8 pb-4">
    <div class="max-w-6xl mx-auto flex items-center gap-3">
      <div class="h-10 w-10 rounded-2xl glass grid place-items-center">
        <!-- tiny bolt icon -->
        <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M13 3L4 14h7l-1 7 9-11h-7l1-7z"/>
        </svg>
      </div>
      <h1 class="text-2xl sm:text-3xl font-semibold">Search Nearby EV Bunk</h1>
    </div>
  </header>

  <!-- Search + Info -->
  <section class="px-6 pb-4">
    <div class="max-w-6xl mx-auto grid gap-4 sm:grid-cols-[1fr,auto] items-center">
      <input id="searchInput" type="text" placeholder="Search by name or address…"
             class="glass ring-glow w-full px-4 py-3 text-base placeholder-gray-400 bg-transparent" />
      <span id="countBadge" class="justify-self-start sm:justify-self-end text-sm text-gray-300"></span>
    </div>
  </section>

  <!-- Container -->
  <main class="px-6 pb-16">
    <div id="status" class="max-w-6xl mx-auto mb-4 text-gray-300"></div>

    <div id="bunkContainer" class="max-w-6xl mx-auto grid gap-6
         grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
      <!-- Cards injected here -->
    </div>
  </main>

  <!-- Firebase (v9+ modular) -->
  <script type="module">
    // ---- 1) IMPORTS ----
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getFirestore, collection, getDocs
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // ---- 2) YOUR CONFIG (REPLACE ↓ WITH YOURS) ----
    const firebaseConfig = {
      apiKey: "AIzaSyCZHsXUzuyolRZMzmu9v6tdzuxqe-3tI8U",
      authDomain: "ev-slot-booking-system.firebaseapp.com",
      projectId: "ev-slot-booking-system",
      storageBucket: "ev-slot-booking-system.firebasestorage.app",
      messagingSenderId: "151538578561",
      appId: "1:151538578561:web:d85940a9567f2bc6220980",
      measurementId: "G-FMMD5N6BVE"
    };
    
    // ---- 3) INIT ----
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ---- 4) UI ELEMENTS ----
    const bunkContainer = document.getElementById("bunkContainer");
    const searchInput = document.getElementById("searchInput");
    const statusEl = document.getElementById("status");
    const countBadge = document.getElementById("countBadge");

    let allBunks = [];

    // ---- 5) HELPERS ----
    const placeholderImg = "https://images.unsplash.com/photo-1542362567-b07e54358753?auto=format&fit=crop&w=1200&q=60";

    function buildMapUrl(doc){
      // Prefer explicit `map` field; else fall back to address query
      if (doc.map) return doc.map;
      if (doc.address) return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(doc.address)}`;
      return "#";
    }

    function phoneHref(mobile){
      if(!mobile) return "#";
      // remove spaces for tel:
      return `tel:${String(mobile).replace(/\s+/g,'')}`;
    }

    function render(bunks){
      bunkContainer.innerHTML = "";
      countBadge.textContent = `${bunks.length} result${bunks.length===1?"":"s"}`;

      if (!bunks.length) {
        bunkContainer.innerHTML = `
          <div class="glass p-6 text-center text-gray-300">
            No EV Bunks found. Try a different search.
          </div>`;
        return;
      }

      bunks.forEach(b => {
        const img = b.image || placeholderImg;
        const fuels = b.fuelTypes || b.fuelType || "Electric";
        const mapUrl = buildMapUrl(b);

        const card = document.createElement("article");
        card.className = "glass card overflow-hidden border border-transparent";

        card.innerHTML = `
          <div class="h-40 w-full overflow-hidden">
            <img src="${img}" alt="${b.name || "EV Bunk"}"
                 class="w-full h-full object-cover" onerror="this.src='${placeholderImg}'">
          </div>

          <div class="p-5 grid gap-2">
            <h2 class="text-lg font-semibold">${b.name || "Unnamed EV Bunk"}</h2>
            <p class="text-sm text-gray-300"><span class="font-medium">Address:</span> ${b.address || "—"}</p>
            <p class="text-sm text-gray-300"><span class="font-medium">Mobile:</span> ${b.mobile || "—"}</p>
            <p class="text-sm text-gray-300"><span class="font-medium">Fuel:</span> ${fuels}</p>

            <div class="mt-3 flex flex-wrap gap-2">
              <a href="${mapUrl}" target="_blank" rel="noopener"
                 class="px-3 py-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 border border-green-400/40">
                 View on Google Maps
              </a>
              ${b.mobile ? `<a href="${phoneHref(b.mobile)}"
                 class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 border border-white/20">
                 Call
              </a>` : ""}
            </div>
          </div>
        `;
        bunkContainer.appendChild(card);
      });
    }

    function filterBunks(q){
      q = q.trim().toLowerCase();
      if(!q) return allBunks;
      return allBunks.filter(b =>
        (b.name || "").toLowerCase().includes(q) ||
        (b.address || "").toLowerCase().includes(q) ||
        (b.fuelTypes || b.fuelType || "").toLowerCase().includes(q)
      );
    }

    // ---- 6) FETCH FROM FIRESTORE ----
    async function loadBunks(){
      statusEl.textContent = "Loading EV bunks…";
      try{
        const snap = await getDocs(collection(db, "evBunks"));
        allBunks = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        render(allBunks);
        statusEl.textContent = "";
      }catch(err){
        console.error(err);
        statusEl.innerHTML = `<span class="text-red-300">Failed to load data: ${err.message}</span>`;
        // Optional: show a minimal fallback so page never looks empty
        render([]);
      }
    }

    // ---- 7) EVENTS ----
    searchInput.addEventListener("input", () => {
      render(filterBunks(searchInput.value));
    });

    // ---- 8) GO ----
    loadBunks();
  </script>
</body>
</html>
