<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit EV Bunk</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white min-h-screen flex items-center justify-center font-[Poppins]">

  <div class="bg-gray-800 rounded-2xl shadow-2xl p-10 w-full max-w-md">
    <h1 class="text-3xl font-bold mb-6 text-center">Edit EV Bunk</h1>

    <form id="editForm" class="space-y-4">
      <div>
        <label class="block mb-2">Bunk Name</label>
        <input type="text" id="bunkName" class="w-full p-3 rounded-xl bg-gray-700 text-white border border-gray-600" required>
      </div>
      <div>
        <label class="block mb-2">Address</label>
        <input type="text" id="bunkAddress" class="w-full p-3 rounded-xl bg-gray-700 text-white border border-gray-600" required>
      </div>
      <div>
        <label class="block mb-2">Mobile</label>
        <input type="text" id="bunkMobile" class="w-full p-3 rounded-xl bg-gray-700 text-white border border-gray-600" required>
      </div>
      <div>
        <label class="block mb-2">Google Map Link</label>
        <input type="url" id="bunkMap" class="w-full p-3 rounded-xl bg-gray-700 text-white border border-gray-600">
      </div>
      <div>
        <label class="block mb-2">Image URL</label>
        <input type="url" id="bunkImage" class="w-full p-3 rounded-xl bg-gray-700 text-white border border-gray-600">
      </div>

      <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 p-3 rounded-xl text-white font-semibold">
        Update Bunk
      </button>
    </form>

    <p id="message" class="text-center mt-4"></p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCZHsXUzuyolRZMzmu9v6tdzuxqe-3tI8U",
      authDomain: "ev-slot-booking-system.firebaseapp.com",
      projectId: "ev-slot-booking-system",
      storageBucket: "ev-slot-booking-system.firebasestorage.app",
      messagingSenderId: "151538578561",
      appId: "1:151538578561:web:d85940a9567f2bc6220980",
      measurementId: "G-FMMD5N6BVE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Get bunk ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const bunkId = urlParams.get('id');

    if (!bunkId) {
      document.getElementById('message').textContent = "No bunk selected for editing.";
      document.getElementById('editForm').style.display = 'none';
    } else {
      // Fetch bunk details and pre-fill form
      const docRef = doc(db, "evBunks", bunkId);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById('bunkName').value = data.name || '';
        document.getElementById('bunkAddress').value = data.address || '';
        document.getElementById('bunkMobile').value = data.mobile || '';
        document.getElementById('bunkMap').value = data.mapLink || '';
        document.getElementById('bunkImage').value = `<data value="${data.imageUrl}" class="imageUrl"></data>` || '';
      } else {
        document.getElementById('message').textContent = "Bunk not found.";
        document.getElementById('editForm').style.display = 'none';
      }
    }

    // Handle form submission
    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      try {
        await updateDoc(doc(db, "evBunks", bunkId), {
          name: document.getElementById('bunkName').value,
          address: document.getElementById('bunkAddress').value,
          mobile: document.getElementById('bunkMobile').value,
          mapLink: document.getElementById('bunkMap').value,
          image: document.getElementById('bunkImage').value
        });

        document.getElementById('message').textContent = "Bunk updated successfully!";
        setTimeout(() => {
          window.location.href = "manage_bunks.html"; // redirect after update
        }, 1500);
      } catch (error) {
        document.getElementById('message').textContent = "Error updating bunk: " + error.message;
      }
    });
  </script>

</body>
</html>
